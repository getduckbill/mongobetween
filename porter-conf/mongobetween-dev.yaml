version: v2

name: mongobetween-dev

build:
  context: ./
  method: docker
  dockerfile: ./Dockerfile

services:
  - name: main
    type: web
    run: |
      --username=$MONGODB_USERNAME --password="$MONGODB_PASSWORD" --ping 
      :27017=mongodb+srv://$MONGODB_HOST/?timeoutMS=$MONGODB_TIMEOUT_MS&connectTimeoutMS=$MONGODB_CONNECT_TIMEOUT_MS&socketTimeoutMS=$MONGODB_SOCKET_TIMEOUT_MS&maxIdleTimeMS=$MONGODB_MAX_IDLE_TIME_MS&minPoolSize=$MONGODB_MIN_POOL_SIZE&maxPoolSize=$MONGODB_MAX_POOL_SIZE&w=majority
    instances: 1
    cpuCores: 0.01
    ramMegabytes: 20
    terminationGracePeriodSeconds: 5
    port: 27017
    private: true

env:
  - key: MONGODB_MAX_IDLE_TIME_MS
    value: "600000"
  - key: MONGODB_SOCKET_TIMEOUT_MS
    value: "20000"
  - key: MONGODB_CONNECT_TIMEOUT_MS
    value: "3000"
  - key: MONGODB_TIMEOUT_MS
    value: "10000"
  - key: MONGODB_MIN_POOL_SIZE
    value: "1"
  - key: MONGODB_MAX_POOL_SIZE
    value: "10"

autoRollback:
  enabled: true
